FROM node:10.11.0

ARG NODE_USER_ID=1000
ARG NODE_GROUP_ID=1000

ENV NPM_CONFIG_LOGLEVEL warn
RUN npm install -g nodemon@1.18.3 ts-node@7.0.1
RUN apt-get update -y && apt-get install -y postgresql-client
RUN mkdir /app
WORKDIR /app
# RUN groupadd nodenew -g 1000
# RUN groupmod -g 200 dialout
# RUN groupmod -g ${NODE_GROUP_ID}} node
# RUN usermod -u 501 node && usermod -g 20 node
RUN usermod -u ${NODE_USER_ID} node
COPY ./bedes-backend/ /app
COPY ./bedes-common /bedes-common
RUN mkdir logs && mkdir /entrypoint 
COPY ./build/lib/backend-entrypoint.sh /entrypoint

RUN chown -R node.node /app
RUN chown -R node.node /bedes-common
USER node
WORKDIR /bedes-common
RUN rm -rf node_modules && npm install
WORKDIR /app
RUN rm -rf node_modules && npm install
CMD ["/entrypoint/backend-entrypoint.sh"]
EXPOSE 3000